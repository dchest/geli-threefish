<title>Installation</title>


0. You should have FreeBSD source code installed.
See [http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/synching.html | Syncronizing Your Source]
in the FreeBSD Handbook. We'll assume sources are located in <code>/usr/src/</code>.

1. Download <b>geli-threefish</b> sources. The easiest way to do is to go to the
[../../../info/trunk | latest revision in trunk] and click "Tarball" or "ZIP
archive". (If you prefer to get the raw patch, [../../../vpatch?from=freebsd&to=trunk | click here]).

2. Replace files in:

  *  <code>/usr/src/sys/geom/eli/<code>
  *  <code>/usr/src/sys/opencrypto/</code>
  *  <code>/usr/src/sys/modules/crypto/</code>

with the ones from <b>geli-threefish</b>.

3. Rebuild and install <code>crypto</code> kernel module (you may need to set
<code>MAKESYSPATH</code> environment variable to <code>/usr/src/share/mk</code>
before building):

<pre>
    # cd /usr/src/modules/crypto
    # make install
</pre>

4. Rebuild and install <code>geom</code> kernel module:

<pre>
    # cd /usr/src/modules/geom
    # make install
</pre>

5. Rebuild and install <code>geli</code> utility:

<pre>
    # cd /usr/src/sbin/geli
    # make install
</pre>

6. If you have <code>geom_eli</code> or <code>crypto</code> modules
   loaded, unload them:

<pre>
    # kldunload geom_eli
    # kldunload crypto
</pre>

If you have encrypted disks mounted, you'll have to unmount and detach them first.

7. Load updated modules:

<pre>
    # kldload geom_eli
</pre>

(This will automatically load <code>crypto</code>).

8. Now you will be able to use <code>geli</code> with <code>-e threefish</code> option.
See [http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/disks-encrypting.html | Disk Encryption with <code>geli</code>] in the FreeBSD Handbook for further information.

For example, to create a new encrypted disk (warning: this is destructive operation):

<pre>
    # geli init -e threefish -s 4096 /dev/da2
</pre>

Enter new password and repeat it. Then attach the device:

<pre>
    # geli attach /dev/da2
</pre>

Enter your password. Now you can access the disk <code>/dev/da2.eli</code>.

Create a filesystem on it:

<pre>
    # newfs /dev/da2.eli
</pre>

and mount it.

<pre>
    # mount /dev/da2.eli /private
</pre>
